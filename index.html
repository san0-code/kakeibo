<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tokyo Dream Project</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;800&family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Noto Sans JP', sans-serif; }
        .font-money { font-family: 'Montserrat', sans-serif; }
        .bg-tokyo { background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); }
        .glass-card { 
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }
        .progress-bar-fill {
            transition: width 1s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .btn-active:active { transform: scale(0.95); opacity: 0.8; }
    </style>
</head>
<body class="bg-tokyo text-slate-800 min-h-screen">
    <div class="max-w-md mx-auto min-h-screen flex flex-col p-4 pb-12">
        
        <header class="glass-card rounded-[32px] p-8 text-center shadow-2xl mt-4 mb-6 relative overflow-hidden">
            <p class="text-[11px] text-slate-400 font-bold tracking-[0.3em] uppercase mb-4">Distance to Tokyo</p>
            <div class="flex justify-center items-baseline gap-2 mb-6">
                <span class="text-2xl font-bold text-slate-300">¥</span>
                <h1 id="balance" class="text-5xl font-extrabold tracking-tighter font-money">-1,000,000</h1>
            </div>

            <div class="space-y-2">
                <div class="flex justify-between text-[10px] font-bold text-slate-400 uppercase tracking-widest px-1">
                    <span>Progress</span>
                    <span id="percentText">0%</span>
                </div>
                <div class="w-full bg-slate-100 h-3 rounded-full overflow-hidden border border-slate-50">
                    <div id="progressBar" class="progress-bar-fill h-full bg-[#A8D8B9] shadow-[0_0_10px_rgba(168,216,185,0.5)]" style="width: 0%"></div>
                </div>
            </div>
        </header>

        <main class="space-y-6">
            <div class="glass-card rounded-[24px] p-6 shadow-lg">
                <label class="text-[10px] font-bold text-slate-400 uppercase ml-1 tracking-widest">Amount Input</label>
                <input type="number" id="amount" placeholder="0" class="w-full text-4xl font-bold p-2 bg-transparent border-b-2 border-slate-100 outline-none focus:border-slate-400 transition-colors font-money">
                
                <div class="grid grid-cols-3 gap-2 mt-4">
                    <button onclick="setAmount(1000)" class="bg-white border border-slate-200 py-2 rounded-xl text-[12px] font-bold text-slate-500 btn-active transition-all">+1,000</button>
                    <button onclick="setAmount(10000)" class="bg-white border border-slate-200 py-2 rounded-xl text-[12px] font-bold text-slate-500 btn-active transition-all">+10,000</button>
                    <button onclick="setAmount(50000)" class="bg-white border border-slate-200 py-2 rounded-xl text-[12px] font-bold text-slate-500 btn-active transition-all">+50,000</button>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <button onclick="addRecord('minus')" class="bg-slate-800 text-white py-5 rounded-[20px] font-bold shadow-lg btn-active transition-all text-sm tracking-widest">SPEND (-)</button>
                <button onclick="addRecord('plus')" class="bg-[#A8D8B9] text-white py-5 rounded-[20px] font-bold shadow-lg btn-active transition-all text-sm tracking-widest">DEPOSIT (+)</button>
            </div>

            <div class="pt-2">
                <div class="flex justify-between items-center mb-4 px-2">
                    <h3 class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Activity Log</h3>
                    <button onclick="clearHistory()" class="text-[10px] font-bold text-rose-300 hover:text-rose-500 transition tracking-widest">RESET DATA</button>
                </div>
                <div id="history" class="space-y-3"></div>
            </div>
        </main>
    </div>

    <script>
        let savedBalance = localStorage.getItem('my_balance');
        let currentBalance = (savedBalance !== null) ? parseInt(savedBalance) : -1000000;
        let historyData = JSON.parse(localStorage.getItem('my_history')) || [];

        updateDisplay();

        function setAmount(val) {
            document.getElementById('amount').value = val;
        }

        function addRecord(type) {
            const amountInput = document.getElementById('amount');
            const amount = parseInt(amountInput.value);
            if (isNaN(amount) || amount <= 0) return;

            if (type === 'minus') currentBalance -= amount;
            else currentBalance += amount;

            historyData.unshift({
                type: type,
                amount: amount,
                date: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})
            });

            saveData();
            updateDisplay();
            amountInput.value = '';
        }

        function clearHistory() {
            if (confirm("データをリセットして東京への旅をやり直しますか？")) {
                currentBalance = -1000000;
                historyData = [];
                saveData();
                updateDisplay();
            }
        }

        function saveData() {
            localStorage.setItem('my_balance', currentBalance);
            localStorage.setItem('my_history', JSON.stringify(historyData));
        }

        function updateDisplay() {
            const balanceElement = document.getElementById('balance');
            balanceElement.innerText = currentBalance.toLocaleString();
            balanceElement.style.color = currentBalance < 0 ? "#f87171" : "#34d399";

            // ★進捗の計算（初期借金額1,000,000円を基準に、0円になったら100%）
            const initialDebt = 1000000;
            let progress = ((initialDebt + currentBalance) / initialDebt) * 100;
            progress = Math.min(Math.max(progress, 0), 100); // 0%~100%の間に収める
            
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('percentText').innerText = Math.floor(progress) + '%';

            const historyElement = document.getElementById('history');
            historyElement.innerHTML = '';
            historyData.forEach(item => {
                const isMinus = item.type === 'minus';
                const html = `
                    <div class="glass-card flex justify-between items-center p-4 rounded-[18px] shadow-sm border-l-4 ${isMinus ? 'border-rose-400' : 'border-[#A8D8B9]'}">
                        <div class="flex flex-col">
                            <span class="text-[9px] font-bold text-slate-400 uppercase">${item.date}</span>
                            <span class="font-bold text-sm">${isMinus ? '支出' : '返済'}</span>
                        </div>
                        <span class="font-bold font-money ${isMinus ? 'text-rose-400' : 'text-[#34d399]'}">
                            ${isMinus ? '-' : '+'}${item.amount.toLocaleString()}
                        </span>
                    </div>`;
                historyElement.insertAdjacentHTML('beforeend', html);
            });
        }
    </script>
</body>
</html>
